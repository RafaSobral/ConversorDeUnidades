<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temperatura</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <script src="{% static 'js/script.js' %}" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div class="conteiner">
        <h1>Conversor de Unidades</h1>
        <div class="conteinerh2">
            <a href="/" class="a">Tamanho</a>
            <a href="/peso/" class="a">Peso</a>
            <a href="/temperatura/" class="Temperatura">Temperatura</a>
        </div>
        <div class="conteinerform">
            <form action="" method="POST" id="form-conversao">{% csrf_token %}
                <h2>Insira a temperatura para conversão</h2>
                <input type="text" id="temperatura" name="temperatura" placeholder="   Insira o temperatura para conversão:">
                <h2>Unidade a ser convertida</h2>
                <select name="unidade1">
                    <option value="C">Celsius (°C)</option>
                    <option value="D">Fahrenheit (°F)</option>
                    <option value="K">Kelvin (K)</option>
                    <option value="R">Rankine (°R)</option>
                </select>
                <h2>Unidade para a qual converter</h2>
                <select name="unidade2">
                    <option value="C">Celsius (°C)</option>
                    <option value="F">Fahrenheit (°F)</option>
                    <option value="K">Kelvin (K)</option>
                    <option value="R">Rankine (°R)</option>
                </select>
                <button type="submit" id="btn-converter">Converter</button>
            </form>
        </div>
        <div id="resultado" style="display: none;">
            <p id="resultado-texto"></p>
            <a href="/temperatura/"><button>Voltar</button></a>
        </div>
        <script>
            document.getElementById("form-conversao").onsubmit = function(event) {
                event.preventDefault();  // Impede o envio tradicional do formulário
                
                // Captura os valores dos inputs
                const formData = new FormData(document.getElementById("form-conversao"));
            
                // Envia os dados para o backend via AJAX (fetch)
                fetch("{% url 'temperatura' %}", {
                    method: "POST",
                    headers: {
                        "X-Requested-With": "XMLHttpRequest"  // Indica uma requisição AJAX
                    },
                    body: formData,
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert("Erro: " + data.error);
                        return;
                    }
            
                    // Esconde os inputs e exibe o resultado
                    document.querySelector(".conteinerform").style.display = "none"; // Esconde o formulário
                    document.getElementById("resultado-texto").textContent = `${data.valor_original} ${data.unidade_original} = ${data.valor_convertido} ${data.unidade_convertida}`;
                    document.getElementById("resultado").style.display = "block";
                })
                .catch(error => console.log("Erro ao fazer a requisição:", error));
            };
            </script>            
    </div>
</body>
</html>